<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Multiply Cats">
<title>üê± Multiply Cats!</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body {
    height: 100%; overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none; user-select: none;
  }
  body {
    font-family: 'Fredoka', sans-serif;
    background: linear-gradient(160deg, #fef9ef 0%, #fdf2e0 40%, #fce8cc 100%);
    display: flex; justify-content: center; align-items: flex-start;
    padding: 16px; padding-top: env(safe-area-inset-top, 16px);
  }
  #app {
    width: 100%; max-width: 440px;
    display: flex; flex-direction: column;
    height: calc(100vh - 32px - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px));
  }

  /* Header */
  .header { text-align: center; margin-bottom: 10px; flex-shrink: 0; }
  .header h1 {
    font-size: 26px; font-weight: 700;
    background: linear-gradient(135deg, #e67e22, #f39c12, #e74c3c);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .header .sub { font-size: 11px; color: #b8a88a; margin-top: 1px; }

  /* Top bar */
  .top-bar {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 8px; flex-shrink: 0; gap: 8px;
  }
  .streak-badge {
    display: none; align-items: center; gap: 5px;
    background: linear-gradient(135deg, #ff6b35, #ff9a56);
    border-radius: 18px; padding: 5px 12px;
    box-shadow: 0 2px 8px rgba(255,107,53,0.3);
  }
  .streak-badge.visible { display: flex; }
  .streak-badge span { font-weight: 700; color: white; font-size: 14px; }
  .stats { display: flex; gap: 10px; font-size: 12px; color: #8b7e6a; }
  .gear-btn {
    background: white; border: 2px solid #e0d4c0; border-radius: 10px;
    padding: 5px 10px; cursor: pointer; font-family: 'Fredoka', sans-serif;
    font-size: 13px; color: #8b7e6a;
  }

  /* Settings panel */
  .settings {
    display: none; background: white; border-radius: 16px; padding: 14px;
    margin-bottom: 10px; border: 2px solid #e0d4c0;
    animation: slideDown 0.25s ease-out; flex-shrink: 0;
  }
  .settings.open { display: block; }
  .settings-label { font-size: 13px; font-weight: 600; color: #5a4e3a; margin-bottom: 8px; }
  .table-grid { display: flex; flex-wrap: wrap; gap: 6px; }
  .table-btn {
    width: 40px; height: 40px; border-radius: 11px;
    border: 2px solid #e0d4c0; background: white;
    font-family: 'Fredoka', sans-serif; font-size: 17px; font-weight: 700;
    color: #8b7e6a; cursor: pointer;
  }
  .table-btn.active {
    border-color: #e67e22;
    background: linear-gradient(135deg, #ffecd2, #fcb69f);
    color: #c0392b;
  }
  .settings-sub { font-size: 10px; color: #b8a88a; margin-top: 6px; }
  .reset-btn {
    margin-top: 10px; background: #f0e6d3; border: none; border-radius: 8px;
    padding: 5px 12px; cursor: pointer; font-family: 'Fredoka', sans-serif;
    font-size: 11px; color: #8b7e6a;
  }
  .stats-section { margin-top: 12px; border-top: 1px solid #f0e6d3; padding-top: 10px; }

  /* Progress bar */
  .progress-wrap { margin-bottom: 10px; flex-shrink: 0; }
  .progress-labels {
    display: flex; justify-content: space-between;
    font-size: 11px; color: #8b7e6a; margin-bottom: 3px;
  }
  .progress-track {
    height: 9px; border-radius: 5px; background: #f0e6d3;
    overflow: hidden; border: 1px solid #e0d4c0;
  }
  .progress-fill {
    height: 100%; border-radius: 5px;
    transition: width 0.5s ease, background 0.5s ease;
  }

  /* Problem card */
  .card {
    background: white; border-radius: 22px; padding: 20px 16px;
    margin-bottom: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    border: 2px solid #f0e6d3; position: relative; overflow: hidden;
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; min-height: 180px; flex: 1 1 auto;
  }
  .card.shake { animation: shake 0.4s ease; }

  .equation {
    font-size: 48px; font-weight: 700; color: #5a4e3a;
    display: flex; align-items: center; gap: 10px;
    animation: float 3s ease-in-out infinite;
  }
  .equation .op { color: #e67e22; font-size: 36px; }
  .equation .eq { color: #b8a88a; font-size: 36px; }
  .equation .q { color: #e67e22; font-size: 36px; }

  .answer-display {
    margin-top: 14px; font-size: 40px; font-weight: 700; color: #5a4e3a;
    min-height: 50px; text-align: center;
    border-bottom: 3px solid #e0d4c0; min-width: 100px; padding: 0 8px;
    transition: border-color 0.3s, color 0.3s;
  }
  .answer-display.wrong { color: #e74c3c; border-color: #e74c3c; }
  .answer-placeholder { color: #ddd; }

  .feedback {
    margin-top: 8px; font-size: 14px; font-weight: 500;
    animation: popIn 0.3s ease;
  }
  .feedback.wrong-msg { color: #e74c3c; }

  /* Reward */
  .reward { position: relative; z-index: 1; text-align: center; }
  .reward-emoji {
    font-size: 60px; margin-bottom: 6px;
    animation: wiggle 0.6s ease-in-out 0.3s;
  }
  .reward-face {
    font-size: 13px; color: #6b5b3a; background: #fff8e7;
    border-radius: 14px; padding: 3px 12px; border: 2px solid #f0d890;
    display: inline-block;
  }
  .reward-msg {
    margin-top: 8px; font-size: 17px; font-weight: 600; color: #e67e22;
  }
  .reward-equation { margin-top: 10px; font-size: 15px; color: #8b7e6a; }
  .reward-hint { margin-top: 6px; font-size: 11px; color: #b8a88a; }

  .reward-container { animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }

  /* Star burst */
  .star {
    position: absolute; left: 50%; top: 50%;
    opacity: 0; animation: starBurst 0.8s ease-out forwards;
  }

  /* Number pad */
  .numpad {
    display: grid; grid-template-columns: repeat(3, 1fr);
    gap: 7px; max-width: 300px; margin: 0 auto; flex-shrink: 0;
  }
  .num-btn {
    font-family: 'Fredoka', sans-serif; font-size: 24px; font-weight: 600;
    padding: 14px 0; border-radius: 14px; border: none; cursor: pointer;
    background: white; color: #5a4e3a;
    box-shadow: 0 3px 0 #e0d4c0;
    transition: transform 0.08s, box-shadow 0.08s;
    -webkit-appearance: none;
  }
  .num-btn:active {
    transform: translateY(2px);
    box-shadow: 0 1px 0 #e0d4c0;
  }
  .num-btn.backspace { font-size: 20px; background: #f0e6d3; color: #8b7e6a; }
  .num-btn.submit {
    font-size: 20px; background: linear-gradient(135deg, #4ecdc4, #44bd60);
    color: white; box-shadow: 0 3px 0 #2d9e5a, 0 4px 12px rgba(68,189,96,0.3);
  }
  .num-btn.submit:active { box-shadow: 0 1px 0 #2d9e5a; }

  .next-btn {
    width: 100%; max-width: 300px; margin: 0 auto; display: block;
    font-family: 'Fredoka', sans-serif; font-size: 18px; font-weight: 600;
    padding: 16px; border-radius: 16px; border: none; cursor: pointer;
    background: linear-gradient(135deg, #f39c12, #e67e22); color: white;
    box-shadow: 0 4px 0 #c0771a, 0 6px 16px rgba(230,126,34,0.3);
    flex-shrink: 0;
  }
  .next-btn:active {
    transform: translateY(2px);
    box-shadow: 0 2px 0 #c0771a;
  }

  /* Cat collection */
  .collection {
    margin-top: 10px; text-align: center; background: white;
    border-radius: 14px; padding: 8px 14px; border: 2px solid #f0e6d3;
    flex-shrink: 0;
  }
  .collection-label { font-size: 10px; color: #b8a88a; letter-spacing: 1px; margin-bottom: 4px; }
  .collection-cats { display: flex; justify-content: center; gap: 3px; flex-wrap: wrap; }
  .collection-cat { font-size: 22px; transition: all 0.3s; }
  .collection-cat.locked { opacity: 0.15; filter: grayscale(1); }

  /* Animations */
  @keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  @keyframes wiggle {
    0%, 100% { transform: rotate(0deg); }
    20% { transform: rotate(-15deg); }
    40% { transform: rotate(12deg); }
    60% { transform: rotate(-8deg); }
    80% { transform: rotate(5deg); }
  }
  @keyframes starBurst {
    0% { transform: translate(-50%, -50%) translate(0, 0) scale(0); opacity: 1; }
    100% { transform: translate(-50%, -50%) translate(var(--tx), var(--ty)) scale(1); opacity: 0; }
  }
  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-8px); }
    40% { transform: translateX(8px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  @keyframes slideDown {
    0% { max-height: 0; opacity: 0; }
    100% { max-height: 500px; opacity: 1; }
  }
</style>
</head>
<body>

<div id="app">
  <div class="header">
    <h1>üê± Multiply Cats!</h1>
    <div class="sub">Collect cats by solving problems!</div>
  </div>

  <div class="top-bar">
    <div id="streakBadge" class="streak-badge">
      <span id="streakFire"></span>
      <span id="streakText"></span>
    </div>
    <div class="stats">
      <span>üê± <span id="catCount">0</span>/10</span>
      <span>‚≠ê <span id="bestStreak">0</span> best</span>
    </div>
    <button class="gear-btn" id="gearBtn">‚öôÔ∏è</button>
  </div>

  <div id="settingsPanel" class="settings">
    <div class="settings-label">Practice tables up to:</div>
    <div class="table-grid" id="tableGrid"></div>
    <div class="settings-sub" id="settingsSub">Currently: 1√ó1 through 5√ó10</div>
    <div class="stats-section" id="statsSection" style="display:none;">
      <div class="settings-label">Session Stats</div>
      <div class="progress-wrap">
        <div class="progress-labels">
          <span id="statsCount"></span><span id="statsPct"></span>
        </div>
        <div class="progress-track">
          <div class="progress-fill" id="statsBar"></div>
        </div>
      </div>
      <button class="reset-btn" id="resetBtn">Reset Session</button>
    </div>
  </div>

  <div id="progressWrap" class="progress-wrap" style="display:none;">
    <div class="progress-labels">
      <span id="progCount"></span><span id="progPct"></span>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="progBar"></div>
    </div>
  </div>

  <div class="card" id="card">
    <div id="starContainer"></div>
    <div id="playView">
      <div class="equation">
        <span id="numA">3</span>
        <span class="op">√ó</span>
        <span id="numB">7</span>
        <span class="eq">=</span>
        <span class="q">?</span>
      </div>
      <div class="answer-display" id="answerDisplay">
        <span class="answer-placeholder">...</span>
      </div>
      <div class="feedback wrong-msg" id="wrongFeedback" style="display:none;"></div>
    </div>
    <div id="rewardView" style="display:none;" class="reward">
      <div class="reward-container">
        <div class="reward-emoji" id="rewardEmoji"></div>
        <div class="reward-face" id="rewardFace"></div>
        <div class="reward-msg" id="rewardMsg"></div>
        <div class="reward-equation" id="rewardEq"></div>
        <div class="reward-hint">Tap Next or press Enter</div>
      </div>
    </div>
  </div>

  <div id="numpadArea">
    <div class="numpad" id="numpad"></div>
  </div>
  <button class="next-btn" id="nextBtn" style="display:none;">Next Problem! ‚Üí</button>

  <div class="collection" id="collection" style="display:none;">
    <div class="collection-label">CAT COLLECTION</div>
    <div class="collection-cats" id="collectionCats"></div>
  </div>
</div>

<script>
const CATS = ["üê±","üêà","üò∫","üò∏","üòª","üêæ","üêà‚Äç‚¨õ","üòΩ","üôÄ","üòπ"];
const FACES = ["^‚Ä¢ œâ ‚Ä¢^","=^._.^=",">^.^<","=^..^=","(=‚ë†œâ‚ë†=)","(=^„Éª^=)","„Öá„ÖÖ„Öá","(=‚åí‚Äø‚Äø‚åí=)","(^._.^)Ôæâ","~(=^‚Ä•^)„Éé"];
const REWARDS = [
  "Purrfect! üéâ","You're a math cat-genius!","Meow-velous work!",
  "Claw-some answer!","Fur-tastic!","You nailed it, kitty!",
  "Un-fur-gettable!","Cat-culating master!","Whisker-sharp brain!",
  "That's the cat's meow!","Hiss-torically great!","Feline fine! üåü",
];
const WRONGS = [
  "Almost! Try again üí™","So close! One more try!","Not quite ‚Äî you got this!",
  "Oops! Give it another shot!","Keep going, you're learning!",
];
const pick = a => a[Math.floor(Math.random()*a.length)];

// State
let maxTable = 5, a = 1, b = 1, input = "", phase = "playing";
let streak = 0, best = 0, correct = 0, total = 0;
let catsCollected = new Set();

// Elements
const $ = id => document.getElementById(id);
const card = $("card"), numA = $("numA"), numB = $("numB");
const answerDisplay = $("answerDisplay"), wrongFeedback = $("wrongFeedback");
const playView = $("playView"), rewardView = $("rewardView");
const nextBtn = $("nextBtn"), numpadArea = $("numpadArea");
const streakBadge = $("streakBadge"), streakFire = $("streakFire"), streakText = $("streakText");
const gearBtn = $("gearBtn"), settingsPanel = $("settingsPanel");
const progressWrap = $("progressWrap");
const collection = $("collection"), collectionCats = $("collectionCats");
const starContainer = $("starContainer");

// Build numpad
const numpad = $("numpad");
[1,2,3,4,5,6,7,8,9,"‚å´",0,"‚úì"].forEach(k => {
  const btn = document.createElement("button");
  btn.className = "num-btn" + (k === "‚å´" ? " backspace" : k === "‚úì" ? " submit" : "");
  btn.textContent = k;
  btn.addEventListener("click", () => handlePress(k));
  // Prevent double-tap zoom on iPad
  btn.addEventListener("touchend", e => { e.preventDefault(); handlePress(k); });
  numpad.appendChild(btn);
});

// Build table grid
const tableGrid = $("tableGrid");
for (let i = 1; i <= 10; i++) {
  const btn = document.createElement("button");
  btn.className = "table-btn" + (i === maxTable ? " active" : "");
  btn.textContent = i;
  btn.dataset.n = i;
  btn.addEventListener("click", () => {
    maxTable = i;
    tableGrid.querySelectorAll(".table-btn").forEach(b => b.classList.toggle("active", +b.dataset.n === i));
    $("settingsSub").textContent = `Currently: 1√ó1 through ${i}√ó10`;
    settingsPanel.classList.remove("open");
    newProblem();
  });
  tableGrid.appendChild(btn);
}

// Build collection
function renderCollection() {
  if (catsCollected.size === 0) { collection.style.display = "none"; return; }
  collection.style.display = "block";
  $("catCount").textContent = catsCollected.size;
  collectionCats.innerHTML = "";
  CATS.forEach((cat, i) => {
    const s = document.createElement("span");
    s.className = "collection-cat" + (catsCollected.has(i) ? "" : " locked");
    s.textContent = cat;
    collectionCats.appendChild(s);
  });
}

function updateProgress() {
  if (total === 0) { progressWrap.style.display = "none"; return; }
  progressWrap.style.display = "block";
  const pct = Math.round((correct / total) * 100);
  $("progCount").textContent = `${correct}/${total} correct`;
  $("progPct").textContent = `${pct}%`;
  const bar = $("progBar");
  bar.style.width = pct + "%";
  bar.style.background = pct >= 80 ? "linear-gradient(90deg,#4ecdc4,#44bd60)"
    : pct >= 50 ? "linear-gradient(90deg,#f7b731,#f5a623)"
    : "linear-gradient(90deg,#fc5c65,#eb3b5a)";
}

function updateStreak() {
  $("bestStreak").textContent = best;
  if (streak >= 3) {
    streakBadge.classList.add("visible");
    const fires = streak >= 10 ? "üî•üî•üî•" : streak >= 5 ? "üî•üî•" : "üî•";
    streakFire.textContent = fires;
    streakText.textContent = streak + " streak!";
  } else {
    streakBadge.classList.remove("visible");
  }
}

function updateSettingsStats() {
  if (total === 0) { $("statsSection").style.display = "none"; return; }
  $("statsSection").style.display = "block";
  const pct = Math.round((correct / total) * 100);
  $("statsCount").textContent = `${correct}/${total} correct`;
  $("statsPct").textContent = `${pct}%`;
  const bar = $("statsBar");
  bar.style.width = pct + "%";
  bar.style.background = pct >= 80 ? "linear-gradient(90deg,#4ecdc4,#44bd60)"
    : pct >= 50 ? "linear-gradient(90deg,#f7b731,#f5a623)"
    : "linear-gradient(90deg,#fc5c65,#eb3b5a)";
}

function spawnStars() {
  starContainer.innerHTML = "";
  for (let i = 0; i < 12; i++) {
    const s = document.createElement("span");
    s.className = "star";
    const angle = (360/12)*i;
    const dist = 40 + Math.random()*60;
    const size = 10 + Math.random()*16;
    s.style.fontSize = size + "px";
    s.style.animationDelay = (Math.random()*0.3) + "s";
    s.style.setProperty("--tx", Math.cos(angle*Math.PI/180)*dist + "px");
    s.style.setProperty("--ty", Math.sin(angle*Math.PI/180)*dist + "px");
    s.textContent = ["‚≠ê","‚ú®","üåü","üí´"][i%4];
    starContainer.appendChild(s);
  }
}

function newProblem() {
  a = Math.floor(Math.random() * maxTable) + 1;
  b = Math.floor(Math.random() * 10) + 1;
  input = "";
  phase = "playing";
  numA.textContent = a;
  numB.textContent = b;
  answerDisplay.innerHTML = '<span class="answer-placeholder">...</span>';
  answerDisplay.classList.remove("wrong");
  wrongFeedback.style.display = "none";
  playView.style.display = "flex";
  playView.style.flexDirection = "column";
  playView.style.alignItems = "center";
  rewardView.style.display = "none";
  nextBtn.style.display = "none";
  numpadArea.style.display = "block";
  starContainer.innerHTML = "";
  card.classList.remove("shake");
}

function showCorrect() {
  const ci = Math.floor(Math.random() * CATS.length);
  catsCollected.add(ci);
  streak++;
  if (streak > best) best = streak;
  correct++;
  total++;

  phase = "correct";
  playView.style.display = "none";
  rewardView.style.display = "block";
  rewardView.innerHTML = `
    <div class="reward-container">
      <div class="reward-emoji">${CATS[ci]}</div>
      <div class="reward-face">${FACES[ci]}</div>
      <div class="reward-msg">${pick(REWARDS)}</div>
      <div class="reward-equation">${a} √ó ${b} = ${a*b}</div>
      <div class="reward-hint">Tap Next or press Enter</div>
    </div>`;
  spawnStars();
  nextBtn.style.display = "block";
  numpadArea.style.display = "none";

  updateStreak();
  updateProgress();
  renderCollection();
}

function showWrong() {
  streak = 0;
  total++;
  phase = "wrong";
  answerDisplay.classList.add("wrong");
  wrongFeedback.textContent = pick(WRONGS);
  wrongFeedback.style.display = "block";
  card.classList.remove("shake");
  void card.offsetWidth; // force reflow
  card.classList.add("shake");

  updateStreak();
  updateProgress();
}

function handlePress(key) {
  if (phase === "correct") {
    newProblem();
    return;
  }
  if (phase === "wrong" && key === "‚úì") {
    phase = "playing"; input = "";
    answerDisplay.innerHTML = '<span class="answer-placeholder">...</span>';
    answerDisplay.classList.remove("wrong");
    wrongFeedback.style.display = "none";
    card.classList.remove("shake");
    return;
  }
  if (phase === "wrong" && key !== "‚å´") {
    phase = "playing";
    input = String(key);
    answerDisplay.textContent = input;
    answerDisplay.classList.remove("wrong");
    wrongFeedback.style.display = "none";
    card.classList.remove("shake");
    return;
  }

  if (key === "‚å´") {
    input = input.slice(0, -1);
    answerDisplay.innerHTML = input || '<span class="answer-placeholder">...</span>';
  } else if (key === "‚úì") {
    if (!input) return;
    const answer = parseInt(input, 10);
    if (answer === a * b) showCorrect();
    else showWrong();
  } else {
    if (input.length < 3) {
      input += String(key);
      answerDisplay.textContent = input;
    }
  }
}

// Keyboard support
document.addEventListener("keydown", e => {
  if (e.key >= "0" && e.key <= "9") handlePress(parseInt(e.key));
  else if (e.key === "Backspace") { e.preventDefault(); handlePress("‚å´"); }
  else if (e.key === "Enter") handlePress("‚úì");
});

// Settings toggle
gearBtn.addEventListener("click", () => {
  const open = settingsPanel.classList.toggle("open");
  if (open) updateSettingsStats();
});

// Next button
nextBtn.addEventListener("click", () => newProblem());

// Reset
$("resetBtn").addEventListener("click", () => {
  correct = 0; total = 0; streak = 0; best = 0;
  catsCollected = new Set();
  settingsPanel.classList.remove("open");
  updateStreak(); updateProgress(); renderCollection();
  newProblem();
});

// Init
newProblem();
updateStreak();
renderCollection();
</script>
</body>
</html>
